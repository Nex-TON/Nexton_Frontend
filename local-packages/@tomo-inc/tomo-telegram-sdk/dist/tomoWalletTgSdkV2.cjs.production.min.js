"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0}),require("zustand");var e=require("./EthereumProvider-225fd49a.js");require("axios"),require("zustand/middleware");var n=t(require("tonweb"));require("viem");var r=require("@ton/core");require("react"),require("qs"),require("uuid");var i=t(require("eventemitter3"));require("buffer");var a=require("@mysten/sui/client");require("@mysten/sui/utils");var s=function(t){function n(n){var r;return(r=t.call(this)||this).utils=new e.ProviderUtils(e._extends({},e.BASE_URL,n)),r.isConnected=!1,r}e._inheritsLoose(n,t);var r=n.prototype;return r.connect=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n,r){var i,a,s,o;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.utils.getMethodInfo(n),a=i[0],!this.utils._accounts||!this.utils._accounts[a]){t.next=6;break}return this.utils._account=s=this.utils._accounts[a],this.isConnected=!0,t.abrupt("return",s);case 6:return t.next=8,this.utils.request({method:n,params:r?[r]:[]});case 8:return o=t.sent,this.isConnected=!0,t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),r.disconnect=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=this.utils.getMethodInfo(n),i=r[0],this.utils._account=null,this.utils.removeAccount(i),this.emit("accountsChanged",[]),this.emit("disconnect","");case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n}(i),o=function(t){function n(n){var r;return(r=t.call(this,n)||this).isConnected=!1,r.chainId=e.mockSolEvmChainId,r.isConnected=!1,r._initialize(),r}e._inheritsLoose(n,t);var r=n.prototype;return r._initialize=function(){var t,e=null==(t=this.utils.storage.get("accounts"))?void 0:t.sol;e&&(this.account=e,this.isConnected=!0)},r.connectWallet=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(r){var i;return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prototype.connect.call(this,"sol_connectWallet",r);case 2:return i=e.sent,this.isConnected=!0,this.account=i,e.abrupt("return",i);case 6:case"end":return e.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),r.disconnectWallet=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.disconnect();case 2:return this.isConnected=!1,t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.sendTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendTransaction$1(n);case 2:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r.getBalance=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n||null!=(r=this.account)&&r.address){t.next=2;break}return t.abrupt("return",{balance:"0",formatted:"0"});case 2:return t.next=4,e.getSolBalance({address:n||this.account.address,token:""});case 4:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.signMessage=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.request({method:"sol_signMessage",params:[n,this.getAddress()]});case 2:return t.abrupt("return",t.sent.result);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.getAddress=function(){var t;return(null==(t=this.account)?void 0:t.address)||""},r.signTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof(null==n?void 0:n.serialize)){t.next=3;break}return console.error("warning: signTransaction using plain js object will be deprecated\nsignTransaction will only accept a Transaction Instance in the future\nfor simple transfer ops, please use 'transfer' method"),t.abrupt("return",this.transfer(n));case 3:return r=n.serialize({requireAllSignatures:!1,verifySignatures:!1}).toString("hex"),t.next=6,this.utils.request({method:"sol_signTx",params:[{chainId:this.chainId,txHex:r}]});case 6:return t.abrupt("return",t.sent.result);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.transfer=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={method:"sol_signTransaction",params:[e._extends({},n,{chainId:this.chainId})]},t.next=3,this.utils.request(r);case 3:return t.abrupt("return",t.sent.result);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.transferToken=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.transfer(n));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.disconnect=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(){return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.account=null,t.prototype.disconnect.call(this,"sol_disconnect");case 2:case"end":return e.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),n}(s);function c(t){var e=r.Cell.fromBase64(Buffer.from(t,"hex").toString("base64")).beginParse();return{operationCode:e.loadUint(32),queryId:e.loadUintBig(64),amount:e.loadCoins(),destination:e.loadAddress()}}function u(t){return d.apply(this,arguments)}function d(){return(d=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(r){var i,a,s;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new n(new n.HttpProvider),a=new n.token.jetton.JettonWallet(i.provider,{address:r}),t.prev=2,t.next=5,a.getData();case 5:return s=t.sent.jettonMinterAddress.toString(!0,!0,!0),console.log("Jetton Minter Address:",s),console.log("This address is a valid Jetton Wallet address."),t.abrupt("return",s);case 12:return t.prev=12,t.t0=t.catch(2),console.error(t.t0),console.log(r+" doesn't seems to be a jetton"),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,null,[[2,12]])})))).apply(this,arguments)}function h(t){for(var e=atob(t),n="",r=0;r<e.length;r++){var i=e.charCodeAt(r).toString(16);n+=2===i.length?i:"0"+i}return n.toUpperCase()}var l=function(t){function n(n){var r;return(r=t.call(this,n)||this).chainId=e.mockTonChainId,r.isConnected=!1,r._initialize(),r}e._inheritsLoose(n,t);var i=n.prototype;return i._initialize=function(){var t,n=null==(t=this.utils.storage.get("accounts"))?void 0:t.ton;n&&(this.account=n,this.isConnected=!0,this.chainId=n.chainId||e.mockTonChainId)},i.connect=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(r){var i,a;return e._regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"testnet"===(null==r?void 0:r.network)&&(this.chainId=e.mockTonTestnetChainId,r.chainId=e.mockTonTestnetChainId),null!=r&&r.tonProof&&(r.domain=r.domain||window.location.hostname,r.workChain=null!=(i=r.workChain)?i:0,r.chainId=e.mockTonChainId),n.next=4,t.prototype.connect.call(this,"ton_connectWallet",r);case 4:if(n.t0=n.sent,n.t0){n.next=7;break}n.t0={address:""};case 7:return(a=n.t0).address&&(this.account=a,this.isConnected=!0),n.abrupt("return",a);case 10:case"end":return n.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),i.restoreConnection=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getAddress());case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.getAddress=function(){var t;return(null==(t=this.account)?void 0:t.address)||""},i.getBalance=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n||null!=(r=this.account)&&r.address){t.next=2;break}return t.abrupt("return",{balance:"0",formatted:"0"});case 2:return t.next=4,e.getTonBalance({tonAddress:n||this.account.address,chainId:this.chainId});case 4:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.signTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i=this;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.map((function(t){return e._extends({chainId:i.chainId,publicKey:i.account.publicKey},t)})),t.next=3,this.utils.request({method:"ton_signTransaction",params:[].concat(r)});case 3:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.signTx=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i=this;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("this.chainId",this.chainId),r=n.map((function(t){return e._extends({chainId:i.chainId,publicKey:i.account.publicKey},t)})),t.next=4,this.utils.request({method:"ton_signTx",params:[].concat(r)});case 4:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.sendTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sendTx(n));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.sendTx=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.from||(n.from=this.getAddress()),0!==n.messages.length){t.next=4;break}throw new Error("No messages");case 4:return t.next=6,this.parsePayloadAsStandard(n);case 6:return this.checkValue(r=t.sent),console.log({txParam:r}),t.next=11,this.signTx([r]);case 11:return i=t.sent,t.next=14,e.sendTransaction(i.result,"",this.chainId);case 14:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.checkValue=function(t){try{r.fromNano(t.body.messages[0].amount)}catch(t){throw new Error("amount must in the format of nanoTon")}},i.parsePayloadAsJSON=function(t,n){var r=JSON.parse(n);return e._extends({},t,{contractAddress:r.contractAddr,precision:r.precision,forwardAmount:r.forwardAmount,memo:r.memo,type:e.TonTxBodyType.JETTON_PAYLOAD_JSON_LEGACY})},i.parsePayloadAsStandard=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i,a,s,o,d,l,p;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=(r=n.messages[0]).address,s={type:e.TonTxBodyType.STANDARD,body:n},i=r.payload){t.next=4;break}return t.abrupt("return",s);case 4:return/^[0-9A-Fa-f]+$/.test(o=i)||(o=h(o),s.body.messages[0].payload=o),t.next=8,u(a);case 8:if(d=t.sent){t.next=11;break}return t.abrupt("return",s);case 11:try{l=c(o),p=l.amount,s.jettonInfo={recipientAddress:l.destination.toString(),amount:p.toString(),jettonMinterAddress:d}}catch(t){console.log("parse payload failed, pass")}return t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.disconnect=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(){return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.account=null,t.prototype.disconnect.call(this,"ton_disconnect");case 2:case"end":return e.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),e._createClass(n,[{key:"connected",get:function(){return this.isConnected}}])}(s),p=new a.SuiClient({url:"https://fullnode.mainnet.sui.io:443"}),f=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){var r,i;return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.bytes,i=n.signature,t.next=3,p.executeTransactionBlock({transactionBlock:r,signature:i});case 3:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(t){function n(e){var n;return(n=t.call(this,e)||this).isConnected=!1,n.chainId=784,n.isConnected=!1,n._initialize(),n}e._inheritsLoose(n,t);var r=n.prototype;return r._initialize=function(){var t,e=null==(t=this.utils.storage.get("accounts"))?void 0:t.sui;e&&(this.account=e,this.isConnected=!0)},r.connectWallet=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(r){var i;return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prototype.connect.call(this,"sui_connectWallet",r);case 2:return i=e.sent,this.isConnected=!0,this.account=i,console.log("sui connect res",i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),r.disconnectWallet=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.disconnect();case 2:return this.isConnected=!1,t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.getAccount=function(){return this.account},r.getAddress=function(){var t;return(null==(t=this.account)?void 0:t.address)||""},r.sendTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f(n);case 2:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r.signMessage=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.request({method:"sui_signMessage",params:[n]});case 2:return t.abrupt("return",t.sent.result);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.signPersonalMessage=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.signMessage(n));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.signTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.request({method:"sui_signTransaction",params:[e._extends({},n,{chainId:this.chainId})]});case 2:return t.abrupt("return",t.sent.result);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.signAndExecuteTransaction=function(){var t=e._asyncToGenerator(e._regeneratorRuntime().mark((function t(n){return e._regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signTransaction(n);case 2:return t.abrupt("return",this.sendTransaction({bytes:n.txBytes,signature:t.sent}));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.disconnect=function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(){return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.account=null,t.prototype.disconnect.call(this,"sui_disconnect");case 2:case"end":return e.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),n}(s);exports.default=function(t){function n(n){var r;(r=t.call(this)||this).version=e.AppInfo.version,r.getAppInfo=function(){return e._extends({},e.AppInfo)};var i=null==n?void 0:n.metaData;return r.connectUrl=(null==n?void 0:n.connect)||e.BASE_URL.connect,r.bridgeUrl=(null==n?void 0:n.bridge)||e.BASE_URL.bridge,r.connect_direct_link=(null==n?void 0:n.connect_direct_link)||e.BASE_URL.connect_direct_link,r.injected=(null==n?void 0:n.injected)||!1,r.metaData={icon:null==i?void 0:i.icon,name:null==i?void 0:i.name,url:null==i?void 0:i.url,direct_link:null==i?void 0:i.direct_link,description:null==i?void 0:i.description},r._initialize(),r}return e._inheritsLoose(n,t),n.prototype._initialize=function(){this.ethereum=new e.EthereumProvider({connect:this.connectUrl,bridge:this.bridgeUrl,connect_direct_link:this.connect_direct_link,metaData:this.metaData}),this.solana=new o({connect:this.connectUrl,bridge:this.bridgeUrl,connect_direct_link:this.connect_direct_link,metaData:this.metaData}),this.tomo_ton=new l({connect:this.connectUrl,bridge:this.bridgeUrl,connect_direct_link:this.connect_direct_link,metaData:this.metaData}),this.tomo_sui=new m({connect:this.connectUrl,bridge:this.bridgeUrl,connect_direct_link:this.connect_direct_link,metaData:this.metaData}),this.injected&&(window.ethereum||(window.ethereum=this.ethereum,dispatchEvent(new Event("ethereum#initialized"))),window.tomo_sol||(window.tomo_sol=this.solana,dispatchEvent(new Event("tomo_sol#initialized"))),window.tomo_ton||(window.tomo_ton=this.tomo_ton,dispatchEvent(new Event("tomo_ton#initialized"))),window.tomo_sui||(window.tomo_sui=this.tomo_sui,dispatchEvent(new Event("tomo_sui#initialized")))),this.emit("_initialized")},n}(i);
//# sourceMappingURL=tomoWalletTgSdkV2.cjs.production.min.js.map
